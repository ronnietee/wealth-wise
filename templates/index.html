<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="STEWARD - Christian Family Budgeting Tool">
    <meta name="csrf-token" content="dummy_token">
    <title>STEWARD - Christian Family Budgeting</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.gstatic.com/s/aptos/v1/aptos-normal-400.woff2" as="font" type="font/woff2" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Aptos:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Direct Aptos font loading */
        @import url('https://fonts.googleapis.com/css2?family=Aptos:wght@300;400;500;600;700&display=swap');
        
        .hero-subtitle {
            font-family: 'Aptos', Arial, sans-serif !important;
            font-weight: 800 !important;
        }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="landing-page">
    <div class="top-ribbon">
        <div class="ribbon-content">
            <div class="ribbon-left">
                <span class="ribbon-text">Welcome to STEWARD</span>
            </div>
            <div class="ribbon-right">
                <button class="ribbon-btn ribbon-login" onclick="showLoginModal()">Login</button>
                <button class="ribbon-btn ribbon-signup" onclick="window.location.href='/onboarding'">Get Started</button>
            </div>
        </div>
    </div>
    <header class="hero">
        <div class="hero-content">
            <h1 class="hero-title">STEWARD</h1>
            <p class="hero-subtitle">You can't get blindsided anymore. Steward gives you full control to plan where your money goes, track expenditure and account for the last cent.</p>
            <div class="hero-actions">
                <button class="btn-modern" onclick="showHowItWorks()">
                    <i class="fas fa-play-circle"></i>
                    How It Works
                </button>
            </div>
        </div>
    </header>

    <section class="features">
        <div class="container">
            <h2 class="section-title">Why Choose STEWARD?</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-church"></i>
                    </div>
                    <h3>Faith-Based Categories</h3>
                    <p>Pre-configured with Christian values including tithe, offering, and social responsibility categories that align with biblical principles of stewardship.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3>Mobile Friendly</h3>
                    <p>Access your budget anywhere, anytime with our responsive design that works seamlessly on all devices - from phones to tablets.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>Smart Tracking</h3>
                    <p>Track your spending against allocated budgets and see real-time balance updates with intuitive visual indicators and progress tracking.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3>Family Focused</h3>
                    <p>Designed specifically for Christian families to manage their finances together with shared goals and transparent budgeting.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Secure & Private</h3>
                    <p>Your financial data is protected with enterprise-grade security. Your information stays private and secure in our encrypted system.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h3>Built with Love</h3>
                    <p>Created by Christians for Christians, with prayer and faith at the heart of every feature to help families honor God with their finances.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-header-content">
                    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="STEWARD Logo" class="modal-header-logo">
                    <h2>Welcome Back</h2>
                </div>
                <button class="close-btn" onclick="closeModal('loginModal')">&times;</button>
            </div>
            <div class="modal-body">
                
                <form id="loginForm" class="auth-form">
                    <div class="form-group">
                        <label for="loginUsername">Username or Email</label>
                        <input type="text" id="loginUsername" name="username" placeholder="Enter your username or email" required>
                        <div class="error-message" id="loginUsernameError"></div>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" name="password" placeholder="Enter your password" required>
                        <div class="error-message" id="loginPasswordError"></div>
                    </div>
                    <div class="form-group remember-me-group">
                        <label class="remember-me-label">
                            <input type="checkbox" id="rememberMe" name="rememberMe" class="remember-me-checkbox">
                            <span class="checkmark"></span>
                            <span class="remember-me-text">Remember Me</span>
                        </label>
                        <a href="#" onclick="openForgotPasswordModal()" class="forgot-password-link">Forgot Password?</a>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Sign In</button>
                    <div style="text-align: center; margin-top: 1rem; font-size: 0.9rem; color: #6c757d;">
                        Don't have an account? <a href="#" onclick="closeModal('loginModal'); window.location.href='/onboarding';" style="color: #8B4513; text-decoration: none;">Sign up here</a>
                    </div>
                </form>
            </div>
        </div>
    </div>


<!-- Forgot Password Modal -->
<div class="modal" id="forgotPasswordModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-key"></i> Reset Password</h3>
            <button class="modal-close" onclick="closeForgotPasswordModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <p>Enter your email address and we'll send you a link to reset your password.</p>
            <form id="forgotPasswordForm">
                <div class="form-group">
                    <label for="forgotEmail">Email Address</label>
                    <input type="email" id="forgotEmail" name="email" placeholder="Enter your email address" required>
                    <div class="error-message" id="forgotEmailError"></div>
                </div>
                <button type="submit" class="btn btn-primary btn-full">
                    <i class="fas fa-paper-plane"></i> Send Reset Link
                </button>
            </form>
        </div>
    </div>
</div>

<!-- How It Works Modal -->
    <div class="modal" id="howItWorksModal">
        <div class="modal-content roadmap-modal">
            <div class="modal-header">
                <h2>How it Works</h2>
                <button class="close-btn" onclick="closeModal('howItWorksModal'); closeAnyModal();">&times;</button>
            </div>
            <div class="modal-body">
                <div class="roadmap-container">
                    <div class="roadmap-step">
                        <div class="step-number">1</div>
                        <div class="step-icon">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <div class="step-content">
                            <h3>Setup</h3>
                            <p>Create spending categories and subcategories. Choose from templates or add your own.</p>
                        </div>
                    </div>
                    
                    <div class="roadmap-step">
                        <div class="step-number">2</div>
                        <div class="step-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="step-content">
                            <h3>Budget</h3>
                            <p>Create your budget for monthly, quarterly, yearly, or custom periods.</p>
                        </div>
                    </div>
                    
                    <div class="roadmap-step">
                        <div class="step-number">3</div>
                        <div class="step-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="step-content">
                            <h3>Income</h3>
                            <p>Define your income sources and amounts.</p>
                        </div>
                    </div>
                    
                    <div class="roadmap-step">
                        <div class="step-number">4</div>
                        <div class="step-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <div class="step-content">
                            <h3>Breakdown</h3>
                            <p>Allocate your income to subcategories.</p>
                        </div>
                    </div>
                    
                    <div class="roadmap-step">
                        <div class="step-number">5</div>
                        <div class="step-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="step-content">
                            <h3>Transactions</h3>
                            <p>Record your expenditure.</p>
                        </div>
                    </div>
                    
                    <div class="roadmap-step">
                        <div class="step-number">6</div>
                        <div class="step-icon">
                            <i class="fas fa-university"></i>
                        </div>
                        <div class="step-content">
                            <h3>Accounts</h3>
                            <p>Track account balances and check budget alignment.</p>
                        </div>
                    </div>
                </div>
                <div class="roadmap-footer">
                    <button class="get-started-btn" onclick="closeModal('howItWorksModal'); window.location.href='/onboarding'">Get Started</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p class="footer-subtitle">"The plans of the diligent lead to profit as surely as haste leads to poverty." - Proverbs 21:5</p>
            <div class="footer-links">
                <a href="/contact" class="footer-link">
                    <i class="fas fa-envelope"></i> Contact Us
                </a>
            </div>
            <p>&copy; 2024 STEWARD. Built with faith and love for Christian families.</p>
        </div>
    </footer>

    <script>
        // Simple Aptos font loading
        document.addEventListener('DOMContentLoaded', function() {
            // Force font application
            const subtitle = document.querySelector('.hero-subtitle');
            if (subtitle) {
                subtitle.style.fontFamily = 'Aptos, Arial, sans-serif';
                subtitle.style.fontWeight = '800';
            }
            
            // Load saved credentials
            loadSavedCredentials();
        });

        // Remember Me functionality (Production Ready)
        function loadSavedCredentials() {
            const savedUsername = localStorage.getItem('steward_username');
            const rememberMe = localStorage.getItem('steward_remember') === 'true';
            
            // Only load username for security (never store passwords in localStorage)
            if (savedUsername && rememberMe) {
                document.getElementById('loginUsername').value = savedUsername;
                document.getElementById('rememberMe').checked = true;
            }
        }

        function saveCredentials() {
            const rememberMe = document.getElementById('rememberMe').checked;
            const username = document.getElementById('loginUsername').value;
            
            if (rememberMe && username) {
                // Only save username, never save passwords in localStorage
                localStorage.setItem('steward_username', username);
                localStorage.setItem('steward_remember', 'true');
            } else {
                localStorage.removeItem('steward_username');
                localStorage.removeItem('steward_remember');
            }
        }

        // Add event listener to login form
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we should show the login modal
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('showLogin') === 'true') {
                showLoginModal();
            }
            
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Save remember me preference
                    saveCredentials();
                    
                    // Get form data
                    const formData = new FormData(loginForm);
                    const loginData = {
                        username: formData.get('username'),
                        password: formData.get('password'),
                        remember: formData.get('rememberMe') === 'on'
                    };
                    
                    // Show loading state
                    const submitBtn = loginForm.querySelector('button[type="submit"]');
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'Signing In...';
                    submitBtn.disabled = true;
                    
                    // Submit to backend
                    fetch('/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCsrfToken()
                        },
                        body: JSON.stringify(loginData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Close modal and redirect
                            closeModal('loginModal');
                            window.location.href = data.redirect || '/dashboard';
                        } else {
                            // Show error message
                            showLoginError(data.message || 'Invalid credentials');
                        }
                    })
                    .catch(error => {
                        console.error('Login error:', error);
                        showLoginError('Login failed. Please try again.');
                    })
                    .finally(() => {
                        // Reset button state
                        submitBtn.textContent = originalText;
                        submitBtn.disabled = false;
                    });
                });
            }
        });

        // Get CSRF token
        function getCsrfToken() {
            // Try to get from meta tag first
            const metaToken = document.querySelector('meta[name="csrf-token"]');
            if (metaToken) {
                return metaToken.getAttribute('content');
            }
            
            // Fallback: fetch from API
            return fetch('/api/csrf-token')
                .then(response => response.json())
                .then(data => data.csrf_token)
                .catch(() => '');
        }

        // Show login error
        function showLoginError(message) {
            // Remove any existing error messages
            const existingError = document.querySelector('.login-error-message');
            if (existingError) {
                existingError.remove();
            }
            
            // Create error message element
            const errorDiv = document.createElement('div');
            errorDiv.className = 'login-error-message';
            errorDiv.style.cssText = `
                background: #f8d7da;
                color: #721c24;
                padding: 0.75rem;
                border-radius: 4px;
                margin-bottom: 1rem;
                border: 1px solid #f5c6cb;
                font-size: 0.9rem;
            `;
            errorDiv.textContent = message;
            
            // Insert before the form
            const form = document.getElementById('loginForm');
            form.parentNode.insertBefore(errorDiv, form);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.remove();
                }
            }, 5000);
        }

    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
</body>
</html>
