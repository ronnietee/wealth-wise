{% extends "base_public.html" %}

{% block title %}Admin Login - STEWARD{% endblock %}

{% block content %}
<div class="container" style="max-width: 500px; margin: 100px auto;">
    <div style="text-align: center; margin-bottom: 30px;">
        <h1><i class="fas fa-shield-alt"></i> Admin Portal</h1>
        <p>STEWARD Administration</p>
    </div>
    
    <div style="background: var(--card-bg); padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <form id="adminLoginForm">
            <div class="form-group">
                <label for="adminUsername">Username</label>
                <input type="text" id="adminUsername" required placeholder="Enter admin username">
            </div>
            
            <div class="form-group">
                <label for="adminPassword">Password</label>
                <input type="password" id="adminPassword" required placeholder="Enter admin password">
            </div>
            
            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
        </form>
        
        <div id="adminError" style="display: none; margin-top: 15px; padding: 10px; background: #f8d7da; color: #721c24; border-radius: 5px;"></div>
    </div>
</div>

<script>
document.getElementById('adminLoginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const username = document.getElementById('adminUsername').value;
    const password = document.getElementById('adminPassword').value;
    const errorDiv = document.getElementById('adminError');
    
    errorDiv.style.display = 'none';
    
    try {
        const response = await fetch('/admin/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        });
        
        let data;
        const responseText = await response.text();
        try {
            data = JSON.parse(responseText);
        } catch (jsonError) {
            // If response is not JSON, show the text response
            console.error('Admin login error - Non-JSON response:', responseText);
            errorDiv.textContent = `Server error: ${response.status} ${response.statusText}. ${responseText.substring(0, 100)}`;
            errorDiv.style.display = 'block';
            return;
        }
        
        if (response.ok) {
            // Store token for API calls
            if (data.token) {
                localStorage.setItem('adminToken', data.token);
            }
            // Redirect to dashboard
            window.location.href = '/admin/dashboard';
        } else {
            errorDiv.textContent = data.message || `Login failed: ${response.status} ${response.statusText}`;
            errorDiv.style.display = 'block';
        }
    } catch (error) {
        console.error('Admin login error:', error);
        errorDiv.textContent = `An error occurred: ${error.message || 'Please try again.'}`;
        errorDiv.style.display = 'block';
    }
});
</script>
{% endblock %}

