{% extends "base_admin.html" %}

{% block title %}Admin - Users{% endblock %}

{% block content %}
<div style="max-width: 1400px; margin: 0 auto;">
    <div style="margin-bottom: 30px;">
        <h1 style="margin: 0 0 10px 0;"><i class="fas fa-users"></i> User Management</h1>
        <div style="margin-top: 15px;">
            <a href="/admin/dashboard" class="btn btn-outline">‚Üê Back to Dashboard</a>
        </div>
    </div>

    <div style="background: var(--card-bg); padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-top: 20px;">
        <h2>All Users</h2>
        <div id="usersTable" style="margin-top: 15px; overflow-x: auto;">
            <p>Loading users...</p>
        </div>
    </div>
</div>

<script>
function getToken() {
    return getAdminToken();
}

async function loadUsers() {
    try {
        // You'll need to create this endpoint or use existing user endpoints
        const response = await adminFetch('/api/admin/users', {
            headers: {
                'Authorization': 'Bearer ' + getToken()
            }
        });
        
        const data = await response.json();
        
        if (response.ok && data.users) {
            if (data.users.length === 0) {
                document.getElementById('usersTable').innerHTML = '<p>No users found.</p>';
            } else {
                const table = `
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid #ddd;">
                                <th style="padding: 10px; text-align: left;">ID</th>
                                <th style="padding: 10px; text-align: left;">Username</th>
                                <th style="padding: 10px; text-align: left;">Email</th>
                                <th style="padding: 10px; text-align: left;">Name</th>
                                <th style="padding: 10px; text-align: left;">Status</th>
                                <th style="padding: 10px; text-align: left;">Created</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.users.map(user => `
                                <tr style="border-bottom: 1px solid #eee;">
                                    <td style="padding: 10px;">${user.id}</td>
                                    <td style="padding: 10px;">${user.username}</td>
                                    <td style="padding: 10px;">${user.email}</td>
                                    <td style="padding: 10px;">${user.first_name} ${user.last_name}</td>
                                    <td style="padding: 10px;">
                                        <span style="padding: 4px 8px; border-radius: 4px; background: ${user.email_verified ? '#d4edda' : '#fff3cd'}; color: ${user.email_verified ? '#155724' : '#856404'};">
                                            ${user.email_verified ? 'Verified' : 'Unverified'}
                                        </span>
                                    </td>
                                    <td style="padding: 10px;">${new Date(user.created_at).toLocaleDateString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                document.getElementById('usersTable').innerHTML = table;
            }
        } else {
            document.getElementById('usersTable').innerHTML = '<p>User management endpoint not yet implemented. Check back soon!</p>';
        }
    } catch (error) {
        console.error('Error:', error);
        document.getElementById('usersTable').innerHTML = '<p>User management endpoint not yet implemented. Check back soon!</p>';
    }
}

document.addEventListener('DOMContentLoaded', loadUsers);
</script>
{% endblock %}

