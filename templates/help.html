{% extends "base.html" %}

{% block title %}User Guide - STEWARD{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1><i class="fas fa-question-circle"></i> User Guide</h1>
        <p class="page-subtitle">Complete guide to using STEWARD for personal finance management</p>
    </div>

    <div class="help-container">
        <!-- Search Box -->
        <div class="help-search">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="helpSearch" placeholder="Search help topics..." class="search-input">
                <button id="clearSearch" class="clear-search-btn" style="display: none;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="searchResults" class="search-results" style="display: none;">
                <div class="search-results-header">
                    <span id="searchResultsCount">0 results found</span>
                    <button id="clearSearchResults" class="clear-results-btn">Clear</button>
                </div>
                <div id="searchResultsList" class="search-results-list"></div>
            </div>
        </div>

        <!-- Table of Contents -->
        <div class="help-toc">
            <h2>Table of Contents</h2>
            <ul class="toc-list">
                <li><a href="#getting-started">Getting Started</a></li>
                <li><a href="#dashboard">Dashboard Overview</a></li>
                <li><a href="#income-management">Income Management</a></li>
                <li><a href="#budget-management">Budget Management</a></li>
                <li><a href="#budget-breakdown">Budget Breakdown</a></li>
                <li><a href="#transactions">Transaction Management</a></li>
                <li><a href="#accounts">Account Management</a></li>
                <li><a href="#settings">Settings & Preferences</a></li>
                <li><a href="#tips-tricks">Tips & Best Practices</a></li>
                <li><a href="#troubleshooting">Troubleshooting</a></li>
            </ul>
        </div>

        <!-- Getting Started Section -->
        <section id="getting-started" class="help-section">
            <h2><i class="fas fa-play-circle"></i> Getting Started</h2>
            
            <div class="help-subsection">
                <h3>First Time Setup</h3>
                <p>When you first create an account, STEWARD will guide you through an onboarding process:</p>
                <ol>
                    <li><strong>Personal Information:</strong> Enter your name and basic details</li>
                    <li><strong>Income Sources:</strong> Add your primary income sources</li>
                    <li><strong>Expense Categories:</strong> Set up your spending categories</li>
                    <li><strong>Budget Period:</strong> Choose your budgeting timeframe (monthly, quarterly, yearly)</li>
                    <li><strong>Account Setup:</strong> Add your financial accounts</li>
                </ol>
            </div>

            <div class="help-subsection">
                <h3>Navigation</h3>
                <p>STEWARD uses a sidebar navigation system with the following main sections:</p>
                <ul>
                    <li><strong>Dashboard:</strong> Your financial overview and quick actions</li>
                    <li><strong>Income:</strong> Manage income sources and balance</li>
                    <li><strong>Breakdown:</strong> Allocate budget across categories</li>
                    <li><strong>Transactions:</strong> View and manage all transactions</li>
                    <li><strong>Accounts:</strong> Manage your financial accounts</li>
                    <li><strong>Budgets:</strong> Create and manage budget periods</li>
                </ul>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section id="dashboard" class="help-section">
            <h2><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
            
            <div class="help-subsection">
                <h3>Financial Overview Cards</h3>
                <p>The dashboard displays key financial metrics in overview cards:</p>
                <ul>
                    <li><strong>Total Income:</strong> Sum of all income sources for the current period</li>
                    <li><strong>Total Expenses:</strong> Sum of all transactions for the current period</li>
                    <li><strong>Available Balance:</strong> Remaining money after expenses</li>
                    <li><strong>Budget Progress:</strong> Visual progress bar showing budget allocation</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Quick Actions</h3>
                <p>The Quick Actions section provides shortcuts to common tasks:</p>
                <ul>
                    <li><strong>Add Transaction:</strong> Quickly record a new expense or income</li>
                    <li><strong>View Breakdown:</strong> Go directly to budget allocation</li>
                    <li><strong>Manage Budgets:</strong> Access budget management tools</li>
                    <li><strong>View Transactions:</strong> See your transaction history</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Budget Period Indicator</h3>
                <p>The top-right corner shows your current budget period. Click the edit icon to manage budget periods or switch between different timeframes.</p>
            </div>
        </section>

        <!-- Income Management Section -->
        <section id="income-management" class="help-section">
            <h2><i class="fas fa-coins"></i> Income Management</h2>
            
            <div class="help-subsection">
                <h3>Adding Income Sources</h3>
                <p>To add a new income source:</p>
                <ol>
                    <li>Go to the Income page</li>
                    <li>Click "Add Source" button</li>
                    <li>Enter source details (name, amount, frequency)</li>
                    <li>Choose if it's recurring or one-time</li>
                    <li>Save the income source</li>
                </ol>
            </div>

            <div class="help-subsection">
                <h3>Recurring Income</h3>
                <p>For regular income like salary or freelance work:</p>
                <ul>
                    <li>Set up as "Recurring" income source</li>
                    <li>Choose frequency (weekly, bi-weekly, monthly, etc.)</li>
                    <li>STEWARD will automatically include it in budget calculations</li>
                    <li>Use "Manage Recurring" to edit or remove recurring sources</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Balance Management</h3>
                <p>The balance section shows:</p>
                <ul>
                    <li><strong>Total Income:</strong> Sum of all income sources</li>
                    <li><strong>Total Allocated:</strong> Amount already allocated to budget categories</li>
                    <li><strong>Available to Allocate:</strong> Remaining income for new allocations</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Recalculate Total Income</h3>
                <p>If you notice discrepancies in your total income calculation, you can use the "Recalculate Total" feature:</p>
                
                <div class="info-box">
                    <h4><i class="fas fa-calculator"></i> When to Use Recalculate</h4>
                    <p>Use this feature when:</p>
                    <ul>
                        <li>Your dashboard shows incorrect total income</li>
                        <li>You've made multiple changes to income sources</li>
                        <li>You notice data inconsistencies after editing/deleting sources</li>
                        <li>The total doesn't match the sum of your income sources</li>
                    </ul>
                </div>

                <div class="info-box">
                    <h4><i class="fas fa-tools"></i> How to Recalculate</h4>
                    <ol>
                        <li>Go to the Income page</li>
                        <li>Click the "Recalculate Total" button (next to Save Balance)</li>
                        <li>Confirm the action in the popup dialog</li>
                        <li>STEWARD will recalculate the total from all income sources</li>
                        <li>Check your dashboard - the total should now be accurate</li>
                    </ol>
                </div>

                <div class="info-box">
                    <h4><i class="fas fa-info-circle"></i> What It Does</h4>
                    <p>The recalculate function:</p>
                    <ul>
                        <li>Adds up all your current income sources</li>
                        <li>Updates the budget's total income field</li>
                        <li>Refreshes the dashboard automatically</li>
                        <li>Ensures data consistency across the application</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Budget Management Section -->
        <section id="budget-management" class="help-section">
            <h2><i class="fas fa-calendar-check"></i> Budget Management</h2>
            
            <div class="help-subsection">
                <h3>Hierarchical Budget Periods</h3>
                <p>STEWARD uses a hierarchical budget period system that allows you to manage different timeframes while maintaining clear separation between periods:</p>
                
                <div class="info-box">
                    <h4><i class="fas fa-calendar-alt"></i> Single Active Period</h4>
                    <p>Only one budget period can be active at a time. When you activate a period, all others become inactive. This ensures clear focus on your current budgeting timeframe.</p>
                </div>

                <div class="info-box">
                    <h4><i class="fas fa-layer-group"></i> Independent Allocations</h4>
                    <p>Each period has its own budget allocations. You can allocate $1000 to groceries monthly and $5000 quarterly - these are completely separate budgets that don't interfere with each other.</p>
                </div>

                <div class="info-box">
                    <h4><i class="fas fa-receipt"></i> Smart Transaction Attribution</h4>
                    <p>Transactions appear in any period they fall within based on their date. A March transaction will show in both the March monthly budget and the Q1 quarterly budget if both periods exist.</p>
                </div>

                <div class="info-box">
                    <h4><i class="fas fa-exclamation-triangle"></i> Period-Specific Overspending Detection</h4>
                    <p>Overspending is checked against the active period's allocations. You might be overspent in your monthly budget but perfectly fine in your quarterly budget.</p>
                </div>
            </div>

            <div class="help-subsection">
                <h3>Creating Budget Periods</h3>
                <p>To create a new budget period:</p>
                <ol>
                    <li>Go to the Budgets page</li>
                    <li>Click "Create Budget" button</li>
                    <li>Choose period type (Monthly, Quarterly, Yearly, or Custom)</li>
                    <li>Set start and end dates</li>
                    <li>Name your budget period</li>
                    <li>Save and activate the budget</li>
                </ol>
                
                <p>STEWARD supports multiple budget period types:</p>
                <ul>
                    <li><strong>Monthly:</strong> 1-month budget periods (e.g., January 2024, February 2024)</li>
                    <li><strong>Quarterly:</strong> 3-month budget periods (e.g., Q1 2024, Q2 2024)</li>
                    <li><strong>Yearly:</strong> 12-month budget periods (e.g., 2024, 2025)</li>
                    <li><strong>Custom:</strong> Set your own start and end dates for specific needs</li>
                </ul>
                
                <div class="warning-box">
                    <h4><i class="fas fa-exclamation-triangle"></i> Important Notes</h4>
                    <ul>
                        <li>You cannot create overlapping periods of the same type (e.g., two monthly periods for January 2024)</li>
                        <li>Different period types can overlap (e.g., January 2024 monthly and Q1 2024 quarterly)</li>
                        <li>When you activate a period, all other periods become inactive</li>
                        <li>Allocations are specific to each period and don't carry over</li>
                    </ul>
                </div>
            </div>

            <div class="help-subsection">
                <h3>Managing Budget Periods</h3>
                <p>From the Budgets page, you can:</p>
                <ul>
                    <li><strong>View All Periods:</strong> See all your budget periods with their status and summary</li>
                    <li><strong>Activate Periods:</strong> Switch between different budget periods</li>
                    <li><strong>Create New Periods:</strong> Add new budget periods for different timeframes</li>
                    <li><strong>Delete Periods:</strong> Remove unused budget periods (this also deletes all associated data)</li>
                    <li><strong>View Period Summary:</strong> See income, spending, and balance for each period</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Best Practices</h3>
                <ul>
                    <li><strong>Start with Monthly:</strong> Begin with monthly budgets for detailed tracking</li>
                    <li><strong>Add Quarterly Views:</strong> Create quarterly periods for broader planning</li>
                    <li><strong>Use Yearly for Goals:</strong> Set up yearly budgets for long-term financial goals</li>
                    <li><strong>Custom for Special Events:</strong> Create custom periods for vacations, holidays, or special projects</li>
                    <li><strong>Regular Review:</strong> Switch between periods regularly to get different perspectives on your finances</li>
                </ul>
            </div>
        </section>

        <!-- Budget Breakdown Section -->
        <section id="budget-breakdown" class="help-section">
            <h2><i class="fas fa-chart-pie"></i> Budget Breakdown</h2>
            
            <div class="help-subsection">
                <h3>Category Allocation</h3>
                <p>The breakdown page allows you to allocate your income across different expense categories:</p>
                <ol>
                    <li>View available income to allocate</li>
                    <li>Set amounts for each category</li>
                    <li>Use the allocation bar to distribute funds</li>
                    <li>Save your allocations</li>
                </ol>
            </div>

            <div class="help-subsection">
                <h3>Category Management</h3>
                <p>You can create and manage expense categories:</p>
                <ul>
                    <li>Add new categories and subcategories</li>
                    <li>Edit existing categories</li>
                    <li>Delete unused categories</li>
                    <li>Set category colors for visual organization</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Allocation Tips</h3>
                <ul>
                    <li>Start with essential categories (housing, food, transportation)</li>
                    <li>Leave some buffer for unexpected expenses</li>
                    <li>Consider savings as a category</li>
                    <li>Review and adjust allocations regularly</li>
                </ul>
            </div>
        </section>

        <!-- Transactions Section -->
        <section id="transactions" class="help-section">
            <h2><i class="fas fa-receipt"></i> Transaction Management</h2>
            
            <div class="help-subsection">
                <h3>Adding Transactions</h3>
                <p>To record a new transaction:</p>
                <ol>
                    <li>Go to the Transactions page</li>
                    <li>Click "Add Transaction" button</li>
                    <li>Fill in transaction details:
                        <ul>
                            <li>Description</li>
                            <li>Amount (positive for income, negative for expenses)</li>
                            <li>Category</li>
                            <li>Date</li>
                            <li>Account (if applicable)</li>
                        </ul>
                    </li>
                    <li>Save the transaction</li>
                </ol>
            </div>

            <div class="help-subsection">
                <h3>Transaction Features</h3>
                <ul>
                    <li><strong>Search:</strong> Find transactions by description or amount</li>
                    <li><strong>Filter:</strong> Filter by category, date range, or amount</li>
                    <li><strong>Edit:</strong> Modify existing transactions</li>
                    <li><strong>Delete:</strong> Remove transactions</li>
                    <li><strong>Export:</strong> Download transaction data</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Transaction Types</h3>
                <ul>
                    <li><strong>Income:</strong> Money coming in (salary, freelance, gifts)</li>
                    <li><strong>Expenses:</strong> Money going out (bills, groceries, entertainment)</li>
                    <li><strong>Transfers:</strong> Money moved between accounts</li>
                </ul>
            </div>
        </section>

        <!-- Accounts Section -->
        <section id="accounts" class="help-section">
            <h2><i class="fas fa-university"></i> Account Management</h2>
            
            <div class="help-subsection">
                <h3>Adding Accounts</h3>
                <p>To add a financial account:</p>
                <ol>
                    <li>Go to the Accounts page</li>
                    <li>Click "Add Account" button</li>
                    <li>Enter account details:
                        <ul>
                            <li>Account name</li>
                            <li>Account type (checking, savings, credit card, etc.)</li>
                            <li>Bank/institution name</li>
                            <li>Account number (last 4 digits)</li>
                            <li>Current balance</li>
                        </ul>
                    </li>
                    <li>Save the account</li>
                </ol>
            </div>

            <div class="help-subsection">
                <h3>Account Types</h3>
                <ul>
                    <li><strong>Checking:</strong> Primary spending account</li>
                    <li><strong>Savings:</strong> Money set aside for future use</li>
                    <li><strong>Credit Card:</strong> Credit accounts (balances shown as negative)</li>
                    <li><strong>Investment:</strong> Investment accounts</li>
                    <li><strong>Cash:</strong> Physical cash on hand</li>
                    <li><strong>Other:</strong> Any other type of account</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Balance Tracking</h3>
                <p>The accounts page shows:</p>
                <ul>
                    <li><strong>Total Accounts Balance:</strong> Sum of all account balances</li>
                    <li><strong>Application Balance:</strong> Calculated balance from transactions</li>
                    <li><strong>Misalignment:</strong> Difference between actual and calculated balances</li>
                </ul>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="help-section">
            <h2><i class="fas fa-cog"></i> Settings & Preferences</h2>
            
            <div class="help-subsection">
                <h3>Account Settings</h3>
                <ul>
                    <li><strong>Display Name:</strong> Change how your name appears</li>
                    <li><strong>Email:</strong> Update your email address</li>
                    <li><strong>Password:</strong> Change your account password</li>
                    <li><strong>Theme:</strong> Switch between light and dark modes</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Data Management</h3>
                <ul>
                    <li><strong>Export Data:</strong> Download your financial data</li>
                    <li><strong>Reset Data:</strong> Clear all data and start fresh</li>
                    <li><strong>Delete Account:</strong> Permanently delete your account</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Privacy & Security</h3>
                <ul>
                    <li>All data is stored securely</li>
                    <li>Passwords are encrypted</li>
                    <li>No financial data is shared with third parties</li>
                    <li>You can export and delete your data at any time</li>
                </ul>
            </div>
        </section>

        <!-- Tips & Best Practices Section -->
        <section id="tips-tricks" class="help-section">
            <h2><i class="fas fa-lightbulb"></i> Tips & Best Practices</h2>
            
            <div class="help-subsection">
                <h3>Getting Started Tips</h3>
                <ul>
                    <li>Start with a simple monthly budget</li>
                    <li>Add transactions regularly for accurate tracking</li>
                    <li>Review your budget weekly or monthly</li>
                    <li>Use categories that match your spending patterns</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Budgeting Best Practices</h3>
                <ul>
                    <li>Follow the 50/30/20 rule: 50% needs, 30% wants, 20% savings</li>
                    <li>Always budget for savings first</li>
                    <li>Leave some buffer for unexpected expenses</li>
                    <li>Review and adjust your budget regularly</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Transaction Management</h3>
                <ul>
                    <li>Record transactions as soon as possible</li>
                    <li>Use descriptive transaction names</li>
                    <li>Regularly reconcile with bank statements</li>
                    <li>Use the search and filter features to find specific transactions</li>
                </ul>
            </div>
        </section>

        <!-- Troubleshooting Section -->
        <section id="troubleshooting" class="help-section">
            <h2><i class="fas fa-tools"></i> Troubleshooting</h2>
            
            <div class="help-subsection">
                <h3>Common Issues</h3>
                <ul>
                    <li><strong>Budget not balanced:</strong> Check that your total allocations don't exceed your income</li>
                    <li><strong>Missing transactions:</strong> Ensure you're in the correct budget period</li>
                    <li><strong>Account misalignment:</strong> Verify account balances match your records</li>
                    <li><strong>Categories not showing:</strong> Make sure categories are properly created</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Income Calculation Issues</h3>
                <p>If you're experiencing problems with income calculations:</p>
                
                <div class="warning-box">
                    <h4><i class="fas fa-exclamation-triangle"></i> Dashboard Shows Wrong Total Income</h4>
                    <p><strong>Symptoms:</strong> Dashboard shows incorrect total income that doesn't match your income sources</p>
                    <p><strong>Solution:</strong></p>
                    <ol>
                        <li>Go to the Income page</li>
                        <li>Click "Recalculate Total" button</li>
                        <li>Confirm the action</li>
                        <li>Check your dashboard - the total should now be correct</li>
                    </ol>
                </div>

                <div class="warning-box">
                    <h4><i class="fas fa-exclamation-triangle"></i> Income Total Doesn't Update After Changes</h4>
                    <p><strong>Symptoms:</strong> After adding, editing, or deleting income sources, the total doesn't change</p>
                    <p><strong>Solution:</strong></p>
                    <ol>
                        <li>Refresh the page and try again</li>
                        <li>If the issue persists, use "Recalculate Total"</li>
                        <li>Check that your changes were saved successfully</li>
                    </ol>
                </div>

                <div class="warning-box">
                    <h4><i class="fas fa-exclamation-triangle"></i> Negative or Zero Total Income</h4>
                    <p><strong>Symptoms:</strong> Dashboard shows â‚¬0.00 or negative income when you have income sources</p>
                    <p><strong>Solution:</strong></p>
                    <ol>
                        <li>Verify you have active income sources on the Income page</li>
                        <li>Check that income amounts are positive numbers</li>
                        <li>Use "Recalculate Total" to fix any data inconsistencies</li>
                        <li>Ensure you're viewing the correct budget period</li>
                    </ol>
                </div>
            </div>

            <div class="help-subsection">
                <h3>Getting Help</h3>
                <ul>
                    <li>Check this user guide for detailed instructions</li>
                    <li>Use the Contact page to reach support</li>
                    <li>Check your internet connection if features aren't loading</li>
                    <li>Try refreshing the page if you encounter errors</li>
                </ul>
            </div>

            <div class="help-subsection">
                <h3>Data Recovery</h3>
                <ul>
                    <li>Your data is automatically saved</li>
                    <li>Use the export feature to backup your data</li>
                    <li>Contact support if you need help recovering data</li>
                </ul>
            </div>
        </section>

        <!-- Contact Information -->
        <div class="help-contact">
            <h2><i class="fas fa-envelope"></i> Need More Help?</h2>
            <p>If you can't find what you're looking for in this guide, feel free to contact us:</p>
            <a href="/contact" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i>
                Contact Support
            </a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('helpSearch');
    const clearSearchBtn = document.getElementById('clearSearch');
    const searchResults = document.getElementById('searchResults');
    const searchResultsCount = document.getElementById('searchResultsCount');
    const searchResultsList = document.getElementById('searchResultsList');
    const clearResultsBtn = document.getElementById('clearSearchResults');

    // Search data - extracted from help content
    const searchData = [
        {
            id: 'getting-started',
            title: 'Getting Started',
            section: 'Getting Started',
            content: 'When you first create an account, STEWARD will guide you through an onboarding process: Personal Information, Income Sources, Expense Categories, Budget Period, Account Setup. STEWARD uses a sidebar navigation system with Dashboard, Income, Budget, Transactions, Accounts, Settings, and Help sections.'
        },
        {
            id: 'dashboard',
            title: 'Dashboard Overview',
            section: 'Dashboard',
            content: 'The dashboard provides a comprehensive overview of your financial situation. Key components include Budget Overview showing total income, allocated amounts, and remaining balance. Income Sources displays all your income streams with amounts. Balance Summary shows your current financial position. Alerts and Notifications for overspending, budget warnings, and important updates. Quick Actions for adding income, expenses, and managing accounts.'
        },
        {
            id: 'income-management',
            title: 'Income Management',
            section: 'Income Management',
            content: 'Add multiple income sources including salary, freelance work, investments, and other earnings. Set up recurring income for automatic tracking. Track one-time income sources. View total income calculations. Edit and delete income sources. Balance brought forward from previous periods.'
        },
        {
            id: 'recalculate-income',
            title: 'Recalculate Total Income',
            section: 'Income Management',
            content: 'The recalculate function ensures your total income is accurate by summing all active income sources. Use this when income amounts seem incorrect or after making changes. Click the "Recalculate Total" button on the Income page. This will update your dashboard totals immediately.'
        },
        {
            id: 'budget-management',
            title: 'Budget Management',
            section: 'Budget Management',
            content: 'Create budget periods with start and end dates. Set monthly, quarterly, or yearly budgets. Activate and deactivate budget periods. View budget history. Track budget performance over time. Manage budget period details and settings.'
        },
        {
            id: 'budget-breakdown',
            title: 'Budget Breakdown',
            section: 'Budget Breakdown',
            content: 'Allocate your budget across different categories and subcategories. Set spending limits for each category. Track allocated vs spent amounts. View remaining budget for each category. Adjust allocations as needed. Monitor budget performance and make adjustments.'
        },
        {
            id: 'transactions',
            title: 'Transaction Management',
            section: 'Transactions',
            content: 'Add income and expense transactions. Categorize transactions by category and subcategory. Add descriptions and comments to transactions. Edit and delete transactions. Filter transactions by date, category, and amount. Export transaction data. View transaction history and trends.'
        },
        {
            id: 'accounts',
            title: 'Account Management',
            section: 'Account Management',
            content: 'Add and manage your financial accounts including checking, savings, credit cards, and investment accounts. Track account balances. Compare real-world account balances with budget balances. Monitor account alignment. Update account information and balances.'
        },
        {
            id: 'settings',
            title: 'Settings & Preferences',
            section: 'Settings',
            content: 'Change your currency preference. Update personal information. Modify password and security settings. Adjust notification preferences. Change theme and display options. Manage account settings and preferences.'
        },
        {
            id: 'tips-tricks',
            title: 'Tips & Best Practices',
            section: 'Tips & Best Practices',
            content: 'Regularly review and update your budget. Set realistic spending limits. Track all transactions promptly. Use categories that match your spending patterns. Review budget performance monthly. Adjust allocations based on actual spending. Keep account balances updated.'
        },
        {
            id: 'troubleshooting',
            title: 'Troubleshooting',
            section: 'Troubleshooting',
            content: 'Common issues include incorrect income calculations, missing budget data, currency not updating, cards not refreshing, allocation errors, and data export problems. Use the recalculate function for income issues. Refresh the page for display problems. Check API endpoints for connection issues.'
        },
        {
            id: 'income-calculation-issues',
            title: 'Income Calculation Issues',
            section: 'Troubleshooting',
            content: 'If income totals seem incorrect, try the recalculate function. Check that all income sources are properly saved. Verify amounts are entered correctly. Use the "Recalculate Total" button on the Income page. Contact support if issues persist.'
        }
    ];

    // Search function
    function performSearch(query) {
        if (!query.trim()) {
            hideSearchResults();
            return;
        }

        const results = searchData.filter(item => {
            const searchText = (item.title + ' ' + item.content + ' ' + item.section).toLowerCase();
            return searchText.includes(query.toLowerCase());
        });

        displaySearchResults(results, query);
    }

    // Display search results
    function displaySearchResults(results, query) {
        if (results.length === 0) {
            searchResultsList.innerHTML = `
                <div class="no-results">
                    <i class="fas fa-search"></i>
                    <p>No results found for "${query}"</p>
                    <p>Try different keywords or check the table of contents</p>
                </div>
            `;
        } else {
            searchResultsList.innerHTML = results.map(result => {
                const highlightedTitle = highlightText(result.title, query);
                const highlightedSnippet = highlightText(getSnippet(result.content, query), query);
                
                return `
                    <div class="search-result-item" onclick="scrollToSection('${result.id}')">
                        <div class="search-result-title">${highlightedTitle}</div>
                        <div class="search-result-snippet">${highlightedSnippet}</div>
                        <div class="search-result-section">${result.section}</div>
                    </div>
                `;
            }).join('');
        }

        searchResultsCount.textContent = `${results.length} result${results.length !== 1 ? 's' : ''} found`;
        searchResults.style.display = 'block';
    }

    // Hide search results
    function hideSearchResults() {
        searchResults.style.display = 'none';
    }

    // Highlight search terms in text
    function highlightText(text, query) {
        if (!query.trim()) return text;
        const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
        return text.replace(regex, '<span class="highlight">$1</span>');
    }

    // Get snippet of content around search term
    function getSnippet(content, query) {
        const index = content.toLowerCase().indexOf(query.toLowerCase());
        if (index === -1) return content.substring(0, 150) + '...';
        
        const start = Math.max(0, index - 50);
        const end = Math.min(content.length, index + query.length + 100);
        let snippet = content.substring(start, end);
        
        if (start > 0) snippet = '...' + snippet;
        if (end < content.length) snippet = snippet + '...';
        
        return snippet;
    }

    // Scroll to section
    function scrollToSection(sectionId) {
        const element = document.getElementById(sectionId);
        if (element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            hideSearchResults();
            searchInput.value = '';
            clearSearchBtn.style.display = 'none';
        }
    }

    // Make scrollToSection globally available
    window.scrollToSection = scrollToSection;

    // Event listeners
    searchInput.addEventListener('input', function() {
        const query = this.value.trim();
        if (query) {
            clearSearchBtn.style.display = 'block';
            performSearch(query);
        } else {
            clearSearchBtn.style.display = 'none';
            hideSearchResults();
        }
    });

    clearSearchBtn.addEventListener('click', function() {
        searchInput.value = '';
        this.style.display = 'none';
        hideSearchResults();
        searchInput.focus();
    });

    clearResultsBtn.addEventListener('click', function() {
        hideSearchResults();
        searchInput.value = '';
        clearSearchBtn.style.display = 'none';
        searchInput.focus();
    });

    // Keyboard shortcuts
    searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            hideSearchResults();
            this.blur();
        }
    });

    // Focus search on Ctrl+K
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'k') {
            e.preventDefault();
            searchInput.focus();
        }
    });
});
</script>

<style>
.help-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 2rem 0;
}

/* Search Styles */
.help-search {
    margin-bottom: 2rem;
}

.search-container {
    position: relative;
    max-width: 500px;
    margin: 0 auto;
}

.search-input {
    width: 100%;
    padding: 1rem 3rem 1rem 3rem;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    background: var(--card-bg);
    color: var(--text-primary);
    font-size: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1);
}

.search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
    font-size: 1.1rem;
}

.clear-search-btn {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.clear-search-btn:hover {
    color: var(--text-primary);
    background: var(--hover-bg);
}

.search-results {
    margin-top: 1rem;
    background: var(--card-bg);
    border-radius: 12px;
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.search-results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-color);
}

.search-results-header span {
    color: var(--text-secondary);
    font-weight: 500;
}

.clear-results-btn {
    background: none;
    border: none;
    color: var(--primary-color);
    cursor: pointer;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    transition: all 0.2s ease;
}

.clear-results-btn:hover {
    background: var(--hover-bg);
}

.search-results-list {
    max-height: 400px;
    overflow-y: auto;
}

.search-result-item {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
    cursor: pointer;
    transition: all 0.2s ease;
}

.search-result-item:last-child {
    border-bottom: none;
}

.search-result-item:hover {
    background: var(--hover-bg);
}

.search-result-title {
    color: var(--text-primary);
    font-weight: 600;
    margin-bottom: 0.25rem;
    font-size: 1rem;
}

.search-result-snippet {
    color: var(--text-secondary);
    font-size: 0.9rem;
    line-height: 1.4;
}

.search-result-section {
    color: var(--primary-color);
    font-size: 0.8rem;
    font-weight: 500;
    margin-top: 0.25rem;
}

.highlight {
    background: rgba(139, 69, 19, 0.2);
    padding: 0.1rem 0.2rem;
    border-radius: 3px;
    font-weight: 600;
}

.no-results {
    padding: 2rem;
    text-align: center;
    color: var(--text-secondary);
}

.no-results i {
    font-size: 2rem;
    margin-bottom: 1rem;
    color: var(--text-tertiary);
}

.help-toc {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
}

.help-toc h2 {
    margin-bottom: 1rem;
    color: var(--text-primary);
}

.toc-list {
    list-style: none;
    padding: 0;
}

.toc-list li {
    margin-bottom: 0.5rem;
}

.toc-list a {
    color: var(--text-secondary);
    text-decoration: none;
    padding: 0.5rem 0;
    display: block;
    transition: color 0.3s ease;
}

.toc-list a:hover {
    color: var(--primary-color);
}

.help-section {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
}

.help-section h2 {
    color: var(--text-primary);
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--primary-color);
}

.help-subsection {
    margin-bottom: 2rem;
}

.help-subsection h3 {
    color: var(--text-primary);
    margin-bottom: 1rem;
}

.help-subsection p {
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 1rem;
}

.help-subsection ul,
.help-subsection ol {
    color: var(--text-secondary);
    line-height: 1.6;
    margin-left: 1.5rem;
    margin-bottom: 1rem;
}

.help-subsection li {
    margin-bottom: 0.5rem;
}

.help-subsection strong {
    color: var(--text-primary);
}

.help-contact {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 2rem;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
}

.help-contact h2 {
    color: var(--text-primary);
    margin-bottom: 1rem;
}

.help-contact p {
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
}

/* Dark mode enhancements */
[data-theme="dark"] .help-toc,
[data-theme="dark"] .help-section,
[data-theme="dark"] .help-contact {
    background: #1e1e1e;
    border: 1px solid rgba(255, 255, 255, 0.05);
}

/* Responsive design */
@media (max-width: 768px) {
    .help-container {
        padding: 1rem 0;
    }
    
    .help-toc,
    .help-section,
    .help-contact {
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
}
</style>
{% endblock %}
